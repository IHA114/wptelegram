window.CMB2=window.CMB2||{},function(i,a,d,b,g){"use strict";var r,s=i.cmb2_l10,l=i.setTimeout,p=function(e){return d(a.getElementById(e))},n={idNumber:!1,repeatEls:'input:not([type="button"],[id^=filelist]),select,textarea,.cmb2-media-status',noEmpty:'input:not([type="button"]):not([type="radio"]):not([type="checkbox"]),textarea',repeatUpdate:'input:not([type="button"]),select,textarea,label',styleBreakPoint:450,mediaHandlers:{},defaults:{time_picker:s.defaults.time_picker,date_picker:s.defaults.date_picker,color_picker:s.defaults.color_picker||{},code_editor:s.defaults.code_editor},media:{frames:{}}};b.init=function(){r=d(a),d.extend(b,n),b.trigger("cmb_pre_init");var e=b.metabox(),t=e.find(".cmb-repeatable-group");b.initPickers(e.find('input[type="text"].cmb2-timepicker'),e.find('input[type="text"].cmb2-datepicker'),e.find('input[type="text"].cmb2-colorpicker')),b.initCodeEditors(e.find(".cmb2-textarea-code:not(.disable-codemirror)")),d('<p><span class="button-secondary cmb-multicheck-toggle">'+s.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)"),b.makeListSortable(),b.makeRepeatableSortable(),e.on("change",".cmb2_upload_file",function(){b.media.field=d(this).attr("id"),p(b.media.field+"_id").val("")}).on("click",".cmb-multicheck-toggle",b.toggleCheckBoxes).on("click",".cmb2-upload-button",b.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",b.handleFileClick).on("click",".cmb2-remove-file-button",b.handleRemoveMedia).on("click",".cmb-add-group-row",b.addGroupRow).on("click",".cmb-add-row-button",b.addAjaxRow).on("click",".cmb-remove-group-row",b.removeGroupRow).on("click",".cmb-remove-row-button",b.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",b.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",b.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",b.toggleHandle),t.length&&t.on("cmb2_add_row",b.emptyValue).on("cmb2_add_row",b.setDefaults).filter(".sortable").each(function(){d(this).find(".cmb-remove-group-row-button").before('<a class="button-secondary cmb-shift-rows move-up alignleft" href="#"><span class="'+s.up_arrow_class+'"></span></a> <a class="button-secondary cmb-shift-rows move-down alignleft" href="#"><span class="'+s.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",b.shiftRows),l(b.resizeoEmbeds,500),d(i).on("resize",b.resizeoEmbeds),p("addtag").length&&b.listenTagAdd(),d(a).on("cmb_init",b.mceEnsureSave),b.trigger("cmb_init")},b.mceEnsureSave=function(){wp.data&&wp.data.hasOwnProperty("subscribe")&&b.canTinyMCE()&&wp.data.subscribe(function(){var e=wp.data.hasOwnProperty("select")?wp.data.select("core/editor"):null;if(e&&e.isSavingPost&&e.isSavingPost()&&i.tinyMCE.editors.length)for(var t=0;t<i.tinyMCE.editors.length;t++)i.tinyMCE.editors[t].save()})},b.canTinyMCE=function(){return s.user_can_richedit&&i.tinyMCE},b.listenTagAdd=function(){r.ajaxSuccess(function(e,t,i){i.data&&i.data.length&&-1!==i.data.indexOf("action=add-tag")&&b.resetBoxes(p("addtag").find(".cmb2-wrap > .cmb2-metabox"))})},b.resetBoxes=function(e){d.each(e,function(){b.resetBox(d(this))})},b.resetBox=function(e){e.find(".wp-picker-clear").trigger("click"),e.find(".cmb2-remove-file-button").trigger("click"),e.find(".cmb-row.cmb-repeatable-grouping:not(:first-of-type) .cmb-remove-group-row").click(),e.find(".cmb-repeat-row:not(:first-child)").remove(),e.find('input:not([type="button"]),select,textarea').each(function(){var e=d(this),t=e.prop("tagName");if("INPUT"===t){var i=e.attr("type");"checkbox"===i||"radio"===i?e.prop("checked",!1):e.val("")}"SELECT"===t&&d("option:selected",this).prop("selected",!1),"TEXTAREA"===t&&e.html("")})},b.resetTitlesAndIterator=function(e){e.group&&d(".cmb-repeatable-group.repeatable").each(function(){var e=d(this),a=e.find(".cmb-add-group-row").data("grouptitle");e.find(".cmb-repeatable-grouping").each(function(e){var t=d(this),i=t.find("h3.cmb-group-title");t.data("iterator",e),i.length&&i.text(a.replace("{#}",e+1))})})},b.toggleHandle=function(e){e.preventDefault(),b.trigger("postbox-toggled",d(this).parent(".postbox").toggleClass("closed"))},b.toggleCheckBoxes=function(e){e.preventDefault();var t=d(this),i=t.closest(".cmb-td").find("input[type=checkbox]:not([disabled])");t.data("checked")?(i.prop("checked",!1),t.data("checked",!1)):(i.prop("checked",!0),t.data("checked",!0))},b.handleMedia=function(e){e.preventDefault();var t=d(this);b.attach_id=!t.hasClass("cmb2-upload-list")&&t.closest(".cmb-td").find(".cmb2-upload-file-id").val(),b.attach_id="0"!==b.attach_id&&b.attach_id,b._handleMedia(t.prev("input.cmb2-upload-file").attr("id"),t.hasClass("cmb2-upload-list"))},b.handleFileClick=function(e){if(!d(e.target).is("a")){e.preventDefault();var t=d(this),i=t.closest(".cmb-td"),a=i.find(".cmb2-upload-button").hasClass("cmb2-upload-list");b.attach_id=a?t.find('input[type="hidden"]').data("id"):i.find(".cmb2-upload-file-id").val(),b.attach_id&&b._handleMedia(i.find("input.cmb2-upload-file").attr("id"),a,b.attach_id)}},b._handleMedia=function(i,a){if(wp){var c,r;if(r=b.mediaHandlers,(c=b.media).field=i,c.$field=p(c.field),c.fieldData=c.$field.data(),c.previewSize=c.fieldData.previewsize,c.sizeName=c.fieldData.sizename,c.fieldName=c.$field.attr("name"),c.isList=a,i in c.frames)return c.frames[i].open();c.frames[i]=wp.media({title:b.metabox().find('label[for="'+i+'"]').text(),library:c.fieldData.queryargs||{},button:{text:s.strings[a?"upload_files":"upload_file"]},multiple:!!a&&"add"}),c.frames[i].states.first().set("filterable","all"),b.trigger("cmb_media_modal_init",c),r.list=function(e,t){var i,a=[];if(r.list.templates||(r.list.templates={image:wp.template("cmb2-list-image"),file:wp.template("cmb2-list-file")}),e.each(function(e){i=r.getAttachmentHtml(e,"list"),a.push(i)}),t)return a;c.$field.siblings(".cmb2-media-status").append(a)},r.single=function(e){r.single.templates||(r.single.templates={image:wp.template("cmb2-single-image"),file:wp.template("cmb2-single-file")});var t=e.first();c.$field.val(t.get("url")),p(c.field+"_id").val(t.get("id"));var i=r.getAttachmentHtml(t,"single");c.$field.siblings(".cmb2-media-status").slideDown().html(i)},r.getAttachmentHtml=function(e,t){var i="image"===e.get("type"),a=r.prepareData(e,i);return r[t].templates[i?"image":"file"](a)},r.prepareData=function(e,t){return t&&r.getImageData.call(e,50),(e=e.toJSON()).mediaField=c.field,e.mediaFieldName=c.fieldName,e.stringRemoveImage=s.strings.remove_image,e.stringFile=s.strings.file,e.stringDownload=s.strings.download,e.stringRemoveFile=s.strings.remove_file,e},r.getImageData=function(e){var t=c.previewSize[0]||e,i=c.previewSize[1]||e,a=this.get("url"),r=this.get("width"),n=this.get("height"),o=this.get("sizes");return o&&(o[c.sizeName]?(a=o[c.sizeName].url,r=o[c.sizeName].width,n=o[c.sizeName].height):o.large&&(a=o.large.url,r=o.large.width,n=o.large.height)),t<r&&(n=Math.floor(t*n/r),r=t),i<n&&(r=Math.floor(i*r/n),n=i),r||(r=t),n||(n="svg"===this.get("filename").split(".").pop()?"100%":i),this.set("sizeUrl",a),this.set("sizeWidth",r),this.set("sizeHeight",n),this},r.selectFile=function(){var e=c.frames[i].state().get("selection"),t=a?"list":"single";b.attach_id&&a?d('[data-id="'+b.attach_id+'"]').parents("li").replaceWith(r.list(e,!0)):r[t](e),b.trigger("cmb_media_modal_select",e,c)},r.openModal=function(){var e,t=c.frames[i].state().get("selection");b.attach_id?((e=wp.media.attachment(b.attach_id)).fetch(),t.set(e?[e]:[])):t.reset(),b.trigger("cmb_media_modal_open",t,c)},c.frames[i].on("select",r.selectFile).on("open",r.openModal),c.frames[i].open()}},b.handleRemoveMedia=function(e){e.preventDefault();var t=d(this);return t.is(".cmb-attach-list .cmb2-remove-file-button")?t.parents(".cmb2-media-item").remove():(b.media.field=t.attr("rel"),b.metabox().find(a.getElementById(b.media.field)).val(""),b.metabox().find(a.getElementById(b.media.field+"_id")).val(""),t.parents(".cmb2-media-status").html("")),!1},b.cleanRow=function(r,n,e){var t=r.find(b.repeatUpdate);if(e){var i=r.find("[id]").not(b.repeatUpdate);r.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove(),i.length&&i.each(function(){var e=d(this),t=e.attr("id"),i=t.replace("_"+n,"_"+b.idNumber),a=r.find('[data-selector="'+t+'"]');e.attr("id",i),a.length&&a.attr("data-selector",i).data("selector",i)})}return t.filter(":checked").removeAttr("checked"),t.find(":checked").removeAttr("checked"),t.filter(":selected").removeAttr("selected"),t.find(":selected").removeAttr("selected",!1),r.find("h3.cmb-group-title").length&&r.find("h3.cmb-group-title").text(r.data("title").replace("{#}",b.idNumber+1)),t.each(function(){b.elReplacements(d(this),n,e)}),b},b.elReplacements=function(e,t,i){var a,r,n=e.attr("for"),o=e.val(),c=e.prop("type"),d=b.getFieldArg(e,"default"),s=void 0!==d&&!1!==d?d:"",l=e.prop("tagName"),p=("radio"===c||"checkbox"===c)&&o,m={};if(n)m={for:n.replace("_"+t,"_"+b.idNumber)};else{var u,f=e.attr("name");r=e.attr("id"),i?(u=f?f.replace("["+t+"][","["+b.idNumber+"]["):"",a=r?r.replace("_"+t+"_","_"+b.idNumber+"_"):""):(u=f?b.replaceLast(f,"["+t+"]","["+b.idNumber+"]"):"",a=r?b.replaceLast(r,"_"+t,"_"+b.idNumber):""),m={id:a,name:u}}if("TEXTAREA"===l&&e.html(s),"SELECT"===l&&g!==typeof d){var h=e.find('[value="'+d+'"]');h.length&&h.attr("selected","selected").prop("selected","selected")}return p&&(e.removeAttr("checked"),g!==typeof d&&o===d&&e.attr("checked","checked").prop("checked","checked")),!i&&e[0].hasAttribute("data-iterator")&&(m["data-iterator"]=b.idNumber),e.removeClass("hasDatepicker").val(p||s).attr(m),e},b.newRowHousekeeping=function(e){var t=e.find(".wp-picker-container"),i=e.find(".cmb2-media-status");return t.length&&t.each(function(){var e=d(this).parent();e.html(e.find('input[type="text"].cmb2-colorpicker').attr("style",""))}),i.length&&i.empty(),b},b.afterRowInsert=function(e){b.initPickers(e.find('input[type="text"].cmb2-timepicker'),e.find('input[type="text"].cmb2-datepicker'),e.find('input[type="text"].cmb2-colorpicker'))},b.updateNameAttr=function(){var e=d(this),t=e.attr("name");if(void 0!==t){var i=parseInt(e.parents(".cmb-repeatable-grouping").data("iterator"),10),a=i-1,r=t.replace("["+i+"]","["+a+"]");e.attr("name",r)}},b.emptyValue=function(e,t){d(b.noEmpty,t).val("")},b.setDefaults=function(e,t){d(b.noEmpty,t).each(function(){var e=d(this),t=b.getFieldArg(e,"default");void 0!==t&&!1!==t&&e.val(t)})},b.addGroupRow=function(e){e.preventDefault();var t=d(this);b.triggerElement(t,"cmb2_add_group_row_start",t);var i=p(t.data("selector")),a=i.find(".cmb-repeatable-grouping").last(),r=parseInt(a.data("iterator"),10);b.idNumber=parseInt(r,10)+1;for(var n=a.clone(),o=n.prop("nodeName")||"div";0<i.find('.cmb-repeatable-grouping[data-iterator="'+b.idNumber+'"]').length;)b.idNumber++;b.newRowHousekeeping(n.data("title",t.data("grouptitle"))).cleanRow(n,r,!0),n.find(".cmb-add-row-button").prop("disabled",!1);var c=d("<"+o+' class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+b.idNumber+'">'+n.html()+"</"+o+">");a.after(c),b.afterRowInsert(c),b.triggerElement(i,{type:"cmb2_add_row",group:!0},c)},b.addAjaxRow=function(e){e.preventDefault();var t=d(this),i=p(t.data("selector")),a=i.find(".empty-row"),r=parseInt(a.find("[data-iterator]").data("iterator"),10);b.idNumber=parseInt(r,10)+1;var n=a.clone();b.newRowHousekeeping(n).cleanRow(n,r),a.removeClass("empty-row hidden").addClass("cmb-repeat-row"),a.after(n),b.afterRowInsert(n),b.triggerElement(i,{type:"cmb2_add_row",group:!1},n)},b.removeGroupRow=function(e){e.preventDefault();var t=d(this),i=p(t.data("selector")),a=t.parents(".cmb-repeatable-grouping");if(i.find(".cmb-repeatable-grouping").length<2)return b.resetRow(a.parents(".cmb-repeatable-group").find(".cmb-add-group-row"),t);b.triggerElement(i,"cmb2_remove_group_row_start",t),a.nextAll(".cmb-repeatable-grouping").find(b.repeatEls).each(b.updateNameAttr),a.remove(),b.triggerElement(i,{type:"cmb2_remove_row",group:!0})},b.removeAjaxRow=function(e){e.preventDefault();var t=d(this);if(!t.hasClass("button-disabled")){var i=t.parents(".cmb-row"),a=t.parents(".cmb-repeat-table");if(a.find(".cmb-row").length<=2)return b.resetRow(i.find(".cmb-add-row-button"),t);i.hasClass("empty-row")&&i.prev().addClass("empty-row").removeClass("cmb-repeat-row"),t.parents(".cmb-repeat-table .cmb-row").remove(),b.triggerElement(a,{type:"cmb2_remove_row",group:!1})}},b.resetRow=function(e,t){e.trigger("click"),t.trigger("click")},b.shiftRows=function(e){e.preventDefault();var t=d(this),i=t.parents(".cmb-repeatable-grouping"),a=t.hasClass("move-up")?i.prev(".cmb-repeatable-grouping"):i.next(".cmb-repeatable-grouping");if(b.triggerElement(t,"cmb2_shift_rows_enter",t,i,a),a.length){b.triggerElement(t,"cmb2_shift_rows_start",t,i,a);var o=[];i.find(b.repeatEls).each(function(){var e,t=d(this),i=t.attr("type");e=t.hasClass("cmb2-media-status")?t.html():"checkbox"===i||"radio"===i?t.is(":checked"):"select"===t.prop("tagName")?t.is(":selected"):t.val(),o.push({val:e,$:t})}),a.find(b.repeatEls).each(function(e){var t,i=d(this),a=i.attr("type");if(i.hasClass("cmb2-media-status")){var r=i.closest(".cmb-repeatable-grouping").attr("data-iterator"),n=o[e].$.closest(".cmb-repeatable-grouping").attr("data-iterator");t=i.html(),i.html(o[e].val),o[e].$.html(t),o[e].$.find("input").each(function(){var e=d(this).attr("name");e=e.replace("["+r+"]","["+n+"]"),d(this).attr("name",e)}),i.find("input").each(function(){var e=d(this).attr("name");e=e.replace("["+n+"]","["+r+"]"),d(this).attr("name",e)})}else"checkbox"===a?(o[e].$.prop("checked",i.is(":checked")),i.prop("checked",o[e].val)):"radio"===a?(i.is(":checked")&&o[e].$.attr("data-checked","true"),o[e].$.is(":checked")&&i.attr("data-checked","true")):"select"===i.prop("tagName")?(o[e].$.prop("selected",i.is(":selected")),i.prop("selected",o[e].val)):(o[e].$.val(i.val()),i.val(o[e].val))}),i.find("input[data-checked=true]").prop("checked",!0).removeAttr("data-checked"),a.find("input[data-checked=true]").prop("checked",!0).removeAttr("data-checked"),i.find('input[type="text"].cmb2-colorpicker').trigger("change"),a.find('input[type="text"].cmb2-colorpicker').trigger("change"),b.triggerElement(t,"cmb2_shift_rows_complete",t,i,a)}},b.initPickers=function(e,t,i){b.trigger("cmb_init_pickers",{time:e,date:t,color:i}),b.initDateTimePickers(e,"timepicker","time_picker"),b.initDateTimePickers(t,"datepicker","date_picker"),b.initColorPickers(i)},b.initDateTimePickers=function(e,a,r){e.length&&e[a]("destroy").each(function(){var e=d(this),t=e.data(a)||{},i=d.extend({},b.defaults[r],t);e[a](b.datePickerSetupOpts(t,i,a))})},b.datePickerSetupOpts=function(e,t,a){var r=d.extend({},t);return t.beforeShow=function(e,t){"timepicker"===a&&b.addTimePickerClasses(t.dpDiv),p("ui-datepicker-div").addClass("cmb2-element"),"function"==typeof r.beforeShow&&r.beforeShow(e,t)},"timepicker"===a&&(t.onChangeMonthYear=function(e,t,i,a){b.addTimePickerClasses(i.dpDiv),"function"==typeof r.onChangeMonthYear&&r.onChangeMonthYear(e,t,i,a)}),t.onClose=function(e,t){var i=p("ui-datepicker-div").removeClass("cmb2-element").hide();"timepicker"!==a||d(t.input).val()||t.input.val(i.find(".ui_tpicker_time").text()),"function"==typeof r.onClose&&r.onClose(e,t)},t},b.addTimePickerClasses=function(e){var t=b.addTimePickerClasses;t.count=t.count||0,l(function(){e.find(".ui-priority-secondary").length?(e.find(".ui-priority-secondary").addClass("button-secondary"),e.find(".ui-priority-primary").addClass("button-primary"),t.count=0):t.count<5&&(t.count++,t(e))},10)},b.initColorPickers=function(e){e.length&&("object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker?e.each(function(){var e=d(this),t=e.data("colorpicker")||{};e.wpColorPicker(d.extend({},b.defaults.color_picker,t))}):e.each(function(e){d(this).after('<div id="picker-'+e+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),p("picker-"+e).hide().farbtastic(d(this))}).focus(function(){d(this).next().show()}).blur(function(){d(this).next().hide()}))},b.initCodeEditors=function(e){b.trigger("cmb_init_code_editors",e),b.defaults.code_editor&&wp&&wp.codeEditor&&e.length&&e.each(function(){wp.codeEditor.initialize(this.id,b.codeEditorArgs(d(this).data("codeeditor")))})},b.codeEditorArgs=function(e){var t=["codemirror","csslint","jshint","htmlhint"],i=d.extend({},b.defaults.code_editor);e=e||{};for(var a=t.length-1;0<=a;a--)e.hasOwnProperty(t[a])&&(i[t[a]]=d.extend({},i[t[a]]||{},e[t[a]]));return i},b.makeListSortable=function(){var e=b.metabox().find(".cmb2-media-status.cmb-attach-list");e.length&&e.sortable({cursor:"move"}).disableSelection()},b.makeRepeatableSortable=function(){var e=b.metabox().find(".cmb-repeat-table .cmb-field-list");e.length&&e.sortable({items:".cmb-repeat-row",cursor:"move"})},b.maybeOembed=function(i){var t=d(this);({focusout:function(){l(function(){b.spinner(".cmb2-metabox",!0)},2e3)},keyup:function(){var e=function(e,t){return i.which<=t&&i.which>=e};(e(48,90)||e(96,111)||e(8,9)||187===i.which||190===i.which)&&b.doAjax(t,i)},paste:function(){l(function(){b.doAjax(t)},100)}})[i.type]()},b.resizeoEmbeds=function(){b.metabox().each(function(){var e=d(this),t=e.parents(".inside"),i=e.parents(".inner-sidebar").length||e.parents("#side-sortables").length,n=i,a=!1;if(!t.length)return!0;var o=t.width();b.styleBreakPoint>o&&(n=!0,a=b.styleBreakPoint-62>o);var c=(o=n?o:Math.round(.82*t.width()*.97))-30;if(!n||i||a||(c-=75),639<c)return!0;var r=e.find(".cmb-type-oembed .embed-status").children().not(".cmb2-remove-wrapper");if(!r.length)return!0;r.each(function(){var e=d(this),t=e.width(),i=e.height(),a=c;e.parents(".cmb-repeat-row").length&&!n&&(a=c-91,a=o<785?a-15:a);var r=Math.round(a*i/t);e.width(a).height(r)})})},b.doAjax=function(e){var t=e.val();if(!(t.length<6)){var i=e.attr("id"),a=e.closest(".cmb-td"),r=a.find(".embed-status"),n=a.find(".embed_wrap"),o=r.find(":first-child"),c=r.length&&o.length?o.width():e.width();b.log("oembed_url",t,i),b.spinner(a),n.html(""),l(function(){d(".cmb2-oembed:focus").val()===t&&d.ajax({type:"post",dataType:"json",url:s.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:t,oembed_width:300<c?c:300,field_id:i,object_id:e.data("objectid"),object_type:e.data("objecttype"),cmb2_ajax_nonce:s.ajax_nonce},success:function(e){b.log(e),b.spinner(a,!0),n.html(e.data)}})},500)}},b.metabox=function(){return b.$metabox||(b.$metabox=d(".cmb2-wrap > .cmb2-metabox")),b.$metabox},b.spinner=function(e,t){var i=t?"removeClass":"addClass";d(".cmb-spinner",e)[i]("is-active")},b.trigger=function(e){var t=Array.prototype.slice.call(arguments,1);t.push(b),r.trigger(e,t)},b.triggerElement=function(e,t){var i=Array.prototype.slice.call(arguments,2);i.push(b),e.trigger(t,i)},b.getFieldArg=function(e,t){return b.getField(e)[t]},b.getFields=function(i){if("function"==typeof i){var a=[];return d.each(s.fields,function(e,t){i(t,e)&&a.push(t)}),a}return s.fields},b.getField=function(t){var i={};if(t=t instanceof jQuery?t.data("hash"):t)try{if(s.fields[t])throw new Error(t);b.getFields(function(e){if("function"==typeof t){if(t(e))throw new Error(e.hash)}else if(e.id&&e.id===t)throw new Error(e.hash)})}catch(e){i=s.fields[e.message]}return i},b.log=function(){s.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},b.replaceLast=function(e,t,i){var a=e.lastIndexOf(t);return e.slice(0,a)+e.slice(a).replace(t,i)},d(b.init)}(window,document,jQuery,window.CMB2);